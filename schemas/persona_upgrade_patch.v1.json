{
  "$defs": {
    "PatchOperation": {
      "description": "JSON Patch-style operations.",
      "enum": [
        "add",
        "replace",
        "remove"
      ],
      "title": "PatchOperation",
      "type": "string"
    },
    "PersonaFieldPatch": {
      "description": "A single field-level change to a persona.",
      "properties": {
        "operation": {
          "$ref": "#/$defs/PatchOperation"
        },
        "path": {
          "title": "Path",
          "type": "string"
        },
        "value": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "items": {},
              "type": "array"
            },
            {
              "additionalProperties": true,
              "type": "object"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Value"
        }
      },
      "required": [
        "operation",
        "path"
      ],
      "title": "PersonaFieldPatch",
      "type": "object"
    }
  },
  "description": "Patch describing changes to a persona definition.\n\nPrecondition: persona_id references existing persona; patches non-empty.\nPostcondition: applying patch to valid persona yields valid persona.",
  "properties": {
    "contract_version": {
      "default": "1.0.0",
      "title": "Contract Version",
      "type": "string"
    },
    "patch_id": {
      "title": "Patch Id",
      "type": "string"
    },
    "persona_id": {
      "title": "Persona Id",
      "type": "string"
    },
    "patches": {
      "items": {
        "$ref": "#/$defs/PersonaFieldPatch"
      },
      "minItems": 1,
      "title": "Patches",
      "type": "array"
    },
    "rationale": {
      "title": "Rationale",
      "type": "string"
    },
    "source_recommendation_ids": {
      "items": {
        "type": "string"
      },
      "title": "Source Recommendation Ids",
      "type": "array"
    },
    "from_version": {
      "default": "0.0.0",
      "title": "From Version",
      "type": "string"
    },
    "to_version": {
      "default": "0.1.0",
      "title": "To Version",
      "type": "string"
    },
    "schema_valid": {
      "default": true,
      "title": "Schema Valid",
      "type": "boolean"
    },
    "status": {
      "default": "proposed",
      "title": "Status",
      "type": "string"
    },
    "emitted_at": {
      "format": "date-time",
      "title": "Emitted At",
      "type": "string"
    }
  },
  "required": [
    "patch_id",
    "persona_id",
    "patches",
    "rationale"
  ],
  "title": "PersonaUpgradePatch",
  "type": "object"
}